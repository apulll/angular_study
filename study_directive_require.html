<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>angular 指令学习-require</title>
	<!-- <link rel="stylesheet" type="text/css" href="css/g.css"> -->
	<script type="text/javascript" src="lib/angular-1.3.10/angular.js"></script>
</head>
<body  ng-app="myApp">
	<div class="header">
		<p class="logo"><a href='/'>angular example</a></p>
	</div>
	<accordion>
		<expander ng-repeat="expander in expanders" etitle="expander.title">{{expander.text}}</expander>
	</accordion>
	<script type="text/ng-template" id="expanderTemp.html">
            <div  class="mybox">
                <div class="mytitle" ng-click="toggleText()">
                {{mytitle}}
                </div>
                <div ng-transclude ng-show="showText">
                </div>
            </div>
        </script>

        <div ng-controller="testC">
            <expander etitle="title">{{text}}</expander>
        </div>
    </script>
	<script>
		var app = angular.module('myApp', []);
		app.controller('testC', ['$scope', function ($scope) {
			$scope.expanders = [
				{
					title:"个人简介",
					text:"大家好，我是一名前端工程师"
				},
				{
					title:"个人简介2",
					text:"大家好，我是一名前端工程师2"
				},
				{
					title:"个人简介3",
					text:"大家好，我是一名前端工程师3"
				},
			]
		}]).directive('accordion', [function () {
			return {
				restrict: 'EA',
				template:'<div ng-transclude></div>',
				replace:true,
				transclude:true,
				controller:function(){
					var expanders = [];
					this.gotOpended = function(selectExpander){
						angular.forEach(expanders,function(e){
							if(selectExpander !=e){
								e.showText = false;
							}
						})
					}
					this.addExpander = function(e){
						expanders.push(e);
					}

				}
			};
		}]).directive('expander', [function () {
			return {
				restrict: 'EA',
				templateUrl:'expanderTemp.html',
				transclude:true,
				require:'^?accordion',
				scope:{
					title:'=etitle'
				},
				link: function (scope, element, attris,accordionController) {
					scope.showText = false;
					accordionController.addExpander(scope);
					scope.toggleText = function(){
						scope.showText = !scope.showText;
						accordionController.gotOpended(scope);
					}
				}
			};
		}])

	</script>
</body>
</html>